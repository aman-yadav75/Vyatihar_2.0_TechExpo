<!DOCTYPE html>
<html lang="en">
<head>

<script>
  window.initialAuthCheckDone = false;

  fetch("/api/check-session")
    .then(res => res.json())
    .then(data => {
      if (data.logged_in === true) {
        state.isAuthenticated = true;
      }
      window.initialAuthCheckDone = true;
    });
</script>

<script>
  window.pageFromServer = "{{ page|default('') }}";
</script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vyatihar - Where Ideas Meet</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
      .nav-link {
         color: #d1d5db !important;
         padding: 4px 6px;
         transition: none !important;
      }
      .nav-link:hover {
         color: white !important;
         background: transparent !important;
      }
      #mainNav.scrolled {
         background: #2f3241ee;
         box-shadow: 0 4px 16px rgba(0,0,0,0.25);
         backdrop-filter: blur(10px);
      }
   </style>
  <style>


    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .glass {
    background: rgba(255,255,255,0.75);
    backdrop-filter: blur(12px) saturate(1.1);
    border: 1px solid rgba(255,255,255,0.4);
    box-shadow: 0 6px 20px rgba(2,6,23,0.08);
    }
    html.dark .glass {
    background: rgba(20,20,30,0.42);
    border: 1px solid rgba(255,255,255,0.06);
    }
   .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    }


    
    .floating {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .loader {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* üåô Dark Mode Styles */
:root {
  color-scheme: light dark;
}

html.dark {
  --bg-color: #0f172a;
  --text-color: #f8fafc;
  --card-bg: rgba(255, 255, 255, 0.1);
  --glass-bg: rgba(255, 255, 255, 0.1);
}

html.dark body {
  background: var(--bg-color);
  color: var(--text-color);
}

html.dark .glass {
  background: var(--glass-bg);
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(12px);
}

html.dark .gradient-bg {
  background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%);
}

html.dark .text-gray-600 {
  color: #cbd5e1 !important;
}
html.dark .text-gray-800 {
  color: #f1f5f9 !important;
}
html.dark .bg-white {
  background-color: #1e293b !important;
}
html.dark .bg-gray-50,
html.dark .bg-gray-100,
html.dark .bg-purple-50,
html.dark .bg-pink-50 {
  background-color: #1e293b !important;
}

/* üåô Fix Navbar Buttons Visibility in Dark Mode */
html.dark .nav-link {
  color: #f1f5f9 !important; /* light gray / white */
}

html.dark .nav-link:hover {
  background-color: rgba(255, 255, 255, 0.1) !important;
}

.nav-link {
  color: #374151; /* normal dark gray text */
  transition: all 0.2s ease-in-out;
}


/* Force dark text visibility in light mode */
h1 span:first-child {
  color: #1a1a1a !important;
}

html.dark h1 span:first-child {
  color: #ffffff !important;
}


/* ü©µ Fix Feature Cards Visibility in Light Mode */
.glass {
  background: rgba(255, 255, 255, 0.92); /* bright but not flat */
  backdrop-filter: blur(14px);
  border: 1px solid rgba(230, 230, 230, 0.6);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
}

/* üåô Better dark mode contrast */
html.dark .glass {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
}

/* ‚ú® Optional ‚Äì make headings always readable inside glass cards */
.glass h3 {
  color: #1f2937; /* dark text */
}

html.dark .glass h3 {
  color: #f8fafc; /* white in dark mode */
}

/* üé® Fix Section Headings Visibility */
h2 {
  color: #1f2937 !important; /* dark gray in light mode */
  transition: color 0.3s ease;
}

html.dark h2 {
  color: #f8fafc !important; /* white in dark mode */
}


/* üéì Fix Explore Subjects Section Visibility */

/* Section Title */
h1, h2, h3 {
  transition: color 0.3s ease;
}

#content h1,
#content h2 {
  color: #1f2937 !important; /* Dark gray for light mode */
}

html.dark #content h1,
html.dark #content h2 {
  color: #f8fafc !important; /* White for dark mode */
}

/* Subject Card Styling */
.glass h3 {
  color: #1f2937 !important; /* Subject name visible in light mode */
}

html.dark .glass h3 {
  color: #f8fafc !important; /* White in dark mode */
}

/* Subject description text */
.glass p {
  color: #374151 !important; /* Slightly darker gray in light mode */
}

html.dark .glass p {
  color: #cbd5e1 !important; /* Softer gray in dark mode */
}

/* Improve the light mode card background */
#content .glass {
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(229, 231, 235, 0.6);
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
}

html.dark #content .glass {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
}

/* üìä Fix Subject Progress Visibility */

/* Light mode (default) */
.glass .text-gray-600 {
  color: #374151 !important; /* visible dark gray for light mode */
}

/* Dark mode adjustments */
html.dark .glass .text-gray-600 {
  color: #e2e8f0 !important; /* light gray for dark mode */
}

/* Progress bar background fix */
.glass .bg-gray-200 {
  background-color: #e5e7eb !important; /* light gray bar for light mode */
}

html.dark .glass .bg-gray-200 {
  background-color: rgba(255, 255, 255, 0.15) !important; /* subtle bar in dark mode */
}

/* Gradient bar remains same (visible in both modes) */
.glass .gradient-bg {
  background: linear-gradient(90deg, #7c3aed 0%, #ec4899 100%) !important;
}

/* Optional: progress text percentage color */
.glass span.font-semibold {
  color: #111827 !important; /* visible in light mode */
}

html.dark .glass span.font-semibold {
  color: #f8fafc !important; /* white in dark mode */
}


/* ü©µ Fix Google Login Button Visibility */
button[type="button"].w-full {
  background-color: #f9fafb !important; /* subtle gray in light mode */
  border: 1px solid #e5e7eb !important; /* light border */
  color: #111827 !important; /* dark text */
  transition: all 0.3s ease;
}

button[type="button"].w-full:hover {
  background-color: #f3f4f6 !important;
}

/* üåô Dark Mode Fix */
html.dark button[type="button"].w-full {
  background-color: rgba(255, 255, 255, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  color: #f8fafc !important;
}

html.dark button[type="button"].w-full:hover {
  background-color: rgba(255, 255, 255, 0.15) !important;
}

/* Prevent content from hiding under navbar */
body {
  padding-top: 4.5rem; /* same height as navbar */
}


/* üé® Navbar Text Visibility Fix */

/* Light mode (normal text) */
.nav-link {
  color: #1f2937 !important; /* Dark gray text for light mode */
  font-weight: 500;
  transition: all 0.3s ease;
}

.nav-link:hover {
  color: #7c3aed !important; /* purple hover effect */
  background-color: rgba(124, 58, 237, 0.08);
}

/* üåô Dark mode (light text) */
html.dark .nav-link {
  color: #f1f5f9 !important; /* light gray text for dark mode */
}

html.dark .nav-link:hover {
  color: #c084fc !important; /* purple hover */
  background-color: rgba(255, 255, 255, 0.1);
}

/* Fix brand name visibility */
nav span.text-2xl {
  color: #1f2937 !important;
}

html.dark nav span.text-2xl {
  color: #ffffff !important;
}

/* üåó Navbar Styling */

.nav-link {
  color: #1f2937; /* light mode dark gray */
  font-weight: 500;
  transition: all 0.3s ease;
}

.nav-link:hover {
  color: #7c3aed; /* purple hover */
  background-color: rgba(124, 58, 237, 0.08);
}

/* Dark Mode Navbar Links */
html.dark .nav-link {
  color: #f1f5f9;
}

html.dark .nav-link:hover {
  color: #c084fc;
  background-color: rgba(255, 255, 255, 0.1);
}

/* Smooth shadow on scroll */
nav.scrolled {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(20px);
}

/* üåó Navbar Colors and Links */

.nav-link {
  color: #1f2937;
  font-weight: 500;
  transition: all 0.25s ease-in-out;
}

.nav-link:hover {
  color: #7c3aed;
  background-color: rgba(124, 58, 237, 0.08);
}

html.dark .nav-link {
  color: #f1f5f9;
}

html.dark .nav-link:hover {
  color: #c084fc;
  background-color: rgba(255, 255, 255, 0.1);
}

/* üß≠ Shadow Effect on Scroll */
nav.scrolled {
  background-color: rgba(255, 255, 255, 0.85);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  backdrop-filter: blur(20px);
}

html.dark nav.scrolled {
  background-color: rgba(15, 23, 42, 0.85);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
}

/* Prevent overlap */
body {
  padding-top: 4rem;
}

/* ü©µ Fix for Testimonial Cards (Light + Dark Mode) */
.testimonial-card {
  color: #1f2937; /* dark text in light mode */
}

.testimonial-card .user-name {
  font-weight: 700;
  color: #1f2937; /* dark gray for visibility */
}

html.dark .testimonial-card .user-name {
  color: #f8fafc; /* white in dark mode */
}

html.dark .testimonial-card {
  color: #e2e8f0; /* light text in dark mode */
}


@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}



</style>


<style>
  /* FIX NAV TEXT INVISIBLE */
  nav a,
  .nav-link,
  nav span,
  nav button {
    color: #ffffff !important;
  }

  /* Menu hover remove */
  .nav-link:hover {
    color: #ffffff !important;
    background: transparent !important;
  }

  /* Make menu items fully visible */
  nav ul li a {
    opacity: 1 !important;
  }
</style>

<style>
  /* Buttons visibility fix */
  nav a.bg-indigo-500,
  nav a.bg-blue-600 {
    color: #ffffff !important;
  }
</style>


  <!-- API  -->

  <script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>


<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
  
  <div id="preloader" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-white">
  <div class="text-center">
    <!-- Add your image here -->

<img src="{{ url_for('static', filename='assets/vyatihar_logo.jpeg') }}" 
     alt="Vyatihar Logo"
     class="w-16 h-16 object-cover rounded-full mx-auto mb-4">

    <!-- Optional loader circle -->
    <div class="loader mx-auto mb-4 border-4 border-gray-300 border-t-purple-600 rounded-full w-10 h-10 animate-spin"></div>

    <h2 class="text-2xl font-bold text-gray-800">Vyatihar</h2>
    <p class="text-gray-600 mt-2">Loading your learning journey...</p>
  </div>
</div>


 <div id="app" style="display: none;">
<!-- FIXED NAVBAR -->
<nav class="fixed top-0 left-0 w-full backdrop-blur-xl bg-black/40 border-b border-white/10 z-50">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">

    <!-- LEFT: LOGO -->
    <a href="/" class="flex items-center gap-3">
      <img src="/static/assets/vyatihar_logo.jpeg" class="h-10 w-10 rounded-full shadow-lg">
      <span class="text-white text-2xl font-bold tracking-wide">Vyatihar</span>
    </a>

    <!-- DESKTOP MENU -->
<ul class="hidden md:flex gap-8 text-gray-300 font-semibold">

  <li><a href="#" id="navHome" onclick="navigateTo('home')" class="hover:text-white transition">Home</a></li>
  <li><a href="#" id="navTeachers" onclick="navigateTo('teachers')" class="hover:text-white transition">Teachers</a></li>
  <li><a href="#" id="navSubjects" onclick="navigateTo('subjects')" class="hover:text-white transition">Subjects</a></li>
  <li><a href="#" id="navProjects" onclick="navigateTo('projects')" class="hover:text-white transition">Projects</a></li>
  <li><a href="#" id="navRewards" onclick="navigateTo('rewards')" class="hover:text-white transition">Rewards</a></li>

  <!-- ‚≠ê NEW AI ASSISTANT LINK -->
  <li><a href="#" id="navAssistant" onclick="navigateTo('assistant')" class="hover:text-white transition">AI Assistant</a></li>

</ul>




    <!-- RIGHT BUTTONS -->
    <div class="hidden md:flex items-center gap-4">

      <!-- Login Button -->
     {% if session.get('user_id') is none %}
    <a href="#"
   onclick="navigateTo('login')"
   class="px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl shadow hover:scale-105 transition">
   Login
</a>

      {% else %}
      
      <!-- Teacher Dashboard -->
      {% if session.get('role') == 'teacher' %}
      <a href="/teacher-dashboard"
         class="px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition">
         Teacher Panel
      </a>
      {% endif %}

      <!-- Logout -->
      <a href="/logout"
         class="px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition">
         Logout
      </a>

      {% endif %}

      <!-- Theme Toggle -->
      <button id="themeToggle" class="text-white text-2xl hover:opacity-70">üåô</button>
    </div>

    <!-- MOBILE MENU BUTTON -->
    <button id="mobileBtn" class="md:hidden text-white text-3xl">‚ò∞</button>

  </div>
<!-- MOBILE MENU -->
<div id="mobileMenu" class="hidden md:hidden flex flex-col bg-black/60 backdrop-blur-xl border-t border-white/10 p-6 text-white">

 <a id="navHomeMobile" href="#" onclick="navigateTo('home')" class="py-2 hover:text-purple-400">Home</a>

<a id="navTeachersMobile" href="#" onclick="navigateTo('teachers')" class="py-2 hover:text-purple-400">Teachers</a>

<a id="navSubjectsMobile" href="#" onclick="navigateTo('subjects')" class="py-2 hover:text-purple-400">Subjects</a>

<a id="navProjectsMobile" href="#" onclick="navigateTo('projects')" class="py-2 hover:text-purple-400">Projects</a>

<a id="navRewardsMobile" href="#" onclick="navigateTo('rewards')" class="py-2 hover:text-purple-400">Rewards</a>

<a id="navMatchMobile" href="#" onclick="navigateTo('match')" class="py-2 hover:text-purple-400">AI Match</a>

<!-- ‚≠ê NEW AI ASSISTANT (Mobile Version) -->
<a id="navAssistantMobile" href="#" onclick="navigateTo('assistant')" class="py-2 hover:text-purple-400">AI Assistant</a>

  <!-- Login / Logout -->
  {% if not session.get('user_id') %}
    <a id="loginButtonMobile" href="#" onclick="navigateTo('login')" class="py-3 bg-purple-600 rounded-lg text-center mt-3">
      Login
    </a>
  {% else %}
    <a href="/logout" class="py-3 bg-red-600 rounded-lg text-center mt-3">
      Logout
    </a>
  {% endif %}
</div>


</nav>

<script>
  const btn = document.getElementById("mobileBtn");
  const menu = document.getElementById("mobileMenu");

  btn.addEventListener("click", () => {
    menu.classList.toggle("hidden");
  });
</script>


<main id="content" class="min-h-screen"></main>
</div>








    <footer class="glass mt-12 py-8">
      <div class="max-w-7xl mx-auto px-4 text-center">
        <p class="text-gray-600">¬© 2025 Vyatihar - Where Ideas Meet. Built for Tech Expo 2025</p>
        <p class="text-sm text-gray-500 mt-2">Empowering learners through collaboration and innovation</p>
      </div>
    </footer>
  </div>

      <div id="googleLoginSection" class="text-center mt-6">
  <div id="googleLoginButton"></div>
</div>




<!-- üî• Firebase Setup -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyClC9mvybO2oA_4UWlfeVZxsjrO4VOi7mM",
  authDomain: "vyatihar-live.firebaseapp.com",
  databaseURL: "https://vyatihar-live-default-rtdb.firebaseio.com",
  projectId: "vyatihar-live",
  storageBucket: "vyatihar-live.firebasestorage.app",
  messagingSenderId: "447656980301",
  appId: "1:447656980301:web:bc01def31d48fb63ab5104"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>


<script>
// üîä Sound permission flag
let audioAllowed = false;

// Enable sound on user click
document.getElementById('enable-sound').addEventListener('click', () => {
  audioAllowed = true;
  alert("üîî Sound enabled!");
  document.getElementById('enable-sound').style.display = 'none';
});

// ==============================
// ‚úÖ Firebase REAL-TIME LISTENER
// ==============================
const liveRef = firebase.database().ref("live_class");

liveRef.on("value", snapshot => {
  const data = snapshot.val();
  if (!data) return;

  // üü¢ If class is live ‚Üí show popup
  if (data.status === "LIVE") {
    showLiveNotification(data);     // <-- FIXED
  }

  // üéß Play sound only when popup triggered
  if (data.status === "LIVE" && audioAllowed) {
    const audio = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
    audio.play().catch(err => console.warn("‚ö†Ô∏è Sound blocked until click:", err));
  }
});

</script>


<script>
    let state = {
      currentPage: 'home',
      isAuthenticated: false,
      user: null,
      coins: 0,
     subjects: [
  { id: 1, name: 'Finance', icon: 'üí∞', progress: 45, students: 1234, description: 'Master financial concepts...', meetLink: 'https://meet.google.com/finance-live' },
  { id: 2, name: 'Marketing', icon: 'üìä', progress: 60, students: 987, description: 'Learn digital marketing...', meetLink: 'https://meet.google.com/marketing-live' },
  { id: 3, name: 'AI & ML', icon: 'ü§ñ', progress: 30, students: 2456, description: 'Dive into artificial intelligence...', meetLink: 'https://meet.google.com/aiml-live' },
  { id: 4, name: 'Web Development', icon: 'üíª', progress: 75, students: 3421, description: 'Build modern apps...', meetLink: 'https://meet.google.com/webdev-live' },
  { id: 5, name: 'Data Science', icon: 'üìà', progress: 20, students: 1876, description: 'Analyze data...', meetLink: 'https://meet.google.com/datasci-live' },
  { id: 6, name: 'Design', icon: 'üé®', progress: 55, students: 1543, description: 'Create UI/UX designs...', meetLink: 'https://meet.google.com/design-live' }
],

      projects: [],
      matches: [
        { id: 1, name: 'Priya Sharma', skill: 'Web Development', language: 'English, Hindi', rating: 4.8, image: 'üë©‚Äçüíª', bio: 'Full-stack developer passionate about teaching' },
        { id: 2, name: 'Rahul Kumar', skill: 'Data Science', language: 'Hindi, English', rating: 4.6, image: 'üë®‚Äçüíº', bio: 'Data analyst with 3 years experience' },
        { id: 3, name: 'Aisha Khan', skill: 'Marketing', language: 'English, Urdu', rating: 4.9, image: 'üë©‚Äçüéì', bio: 'Digital marketing expert and mentor' },
        { id: 4, name: 'Vikram Singh', skill: 'Finance', language: 'Hindi, English', rating: 4.7, image: 'üë®‚Äçüíº', bio: 'Financial analyst and investment advisor' }
      ]
    };



  // --- add AFTER your "state" object declaration ---
  const translations = {
    en: {
      learnTogether: "Learn Together with",
      description: "Where Ideas Meet & Knowledge Grows. Connect with learners and mentors worldwide through AI-powered matchmaking.",
      getStarted: "Get Started Free",
      learnMore: "Learn More",
      login: "Login",
      subjects: "Subjects",
      dashboard: "Dashboard",
      projects: "Projects",
      rewards: "Rewards",
      enableSound: "Enable Sound Alerts"
    },
    hi: {
      learnTogether: "‡§∏‡§æ‡§• ‡§Æ‡§ø‡§≤‡§ï‡§∞ ‡§∏‡•Ä‡§ñ‡•á‡§Ç",
      description: "‡§ú‡§π‡§æ‡§Å ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§Æ‡§ø‡§≤‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§ú‡•ç‡§û‡§æ‡§® ‡§¨‡•ù‡§§‡§æ ‡§π‡•à‡•§ ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§≠‡§∞ ‡§ï‡•á ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§ï‡•ã‡§Ç ‡§∏‡•á ‡§ú‡•Å‡•ú‡•á‡§Ç‡•§",
      getStarted: "‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
      learnMore: "‡§î‡§∞ ‡§ú‡§æ‡§®‡•á‡§Ç",
      login: "‡§≤‡•â‡§ó‡§ø‡§®",
      subjects: "‡§µ‡§ø‡§∑‡§Ø",
      dashboard: "‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
      projects: "‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏",
      rewards: "‡§á‡§®‡§æ‡§Æ",
      enableSound: "üîä ‡§ß‡•ç‡§µ‡§®‡§ø ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡•á‡§Ç"
    },
    mr: {
      learnTogether: "‡§è‡§ï‡§§‡•ç‡§∞ ‡§∂‡§ø‡§ï‡§æ",
      description: "‡§ú‡§ø‡§•‡•á ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§≠‡•á‡§ü‡§§‡§æ‡§§ ‡§Ü‡§£‡§ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§µ‡§æ‡§¢‡§§‡•á. ‡§ú‡§ó‡§≠‡§∞‡§æ‡§§‡•Ä‡§≤ ‡§∂‡§ø‡§ï‡§£‡§æ‡§±‡•ç‡§Ø‡§æ‡§Ç‡§∂‡•Ä ‡§Ü‡§£‡§ø ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§ï‡§æ‡§Ç‡§∂‡•Ä ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§µ‡•ç‡§π‡§æ.",
      getStarted: "‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
      learnMore: "‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§£‡•Ç‡§® ‡§ò‡•ç‡§Ø‡§æ",
      login: "‡§≤‡•â‡§ó‡§ø‡§®",
      subjects: "‡§µ‡§ø‡§∑‡§Ø",
      dashboard: "‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
      projects: "‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏",
      rewards: "‡§¨‡§ï‡•ç‡§∑‡§ø‡§∏‡•á",
      enableSound: "üîä ‡§Ü‡§µ‡§æ‡§ú ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡§æ"
    },
    ta: {
      learnTogether: "‡Æá‡Æ£‡Øà‡Æ®‡Øç‡Æ§‡ØÅ ‡Æï‡Æ±‡Øç‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      description: "‡Æö‡Æø‡Æ®‡Øç‡Æ§‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ±‡Æø‡Æµ‡ØÅ ‡Æµ‡Æ≥‡Æ∞‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ. ‡Æâ‡Æ≤‡Æï‡Æ≥‡Ææ‡Æµ‡Æø‡ÆØ ‡Æ™‡ÆØ‡Æø‡Æ≤‡Øç‡Æ§‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡Æï.",
      getStarted: "‡Æ§‡Øä‡Æü‡Æï‡Øç‡Æï‡ÆÆ‡Øç",
      learnMore: "‡ÆÆ‡Øá‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ±‡Æø‡Æ®‡Øç‡Æ§‡ØÅ ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥",
      login: "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ",
      subjects: "‡Æ™‡Ææ‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      dashboard: "‡Æü‡Øá‡Æ∑‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡ØÅ",
      projects: "‡Æ™‡Æ£‡Æø‡Æï‡Æ≥‡Øç",
      rewards: "‡Æ™‡Æ∞‡Æø‡Æö‡ØÅ‡Æï‡Æ≥‡Øç",
      enableSound: "üîä ‡Æí‡Æ≤‡Æø ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ"
    }
  };

function applyLanguage(lang) {
  const t = translations[lang] || translations["en"];

  // üåü HOME PAGE
  if (document.getElementById("learnTogetherText"))
    document.getElementById("learnTogetherText").innerText = t.learnTogether;

  if (document.getElementById("descriptionText"))
    document.getElementById("descriptionText").innerText = t.description;

  if (document.getElementById("getStartedBtn"))
    document.getElementById("getStartedBtn").innerText = t.getStarted;

  if (document.getElementById("learnMoreBtn"))
    document.getElementById("learnMoreBtn").innerText = t.learnMore;

  // üåü NAVBAR (Desktop)
  if (document.getElementById("navHome"))
    document.getElementById("navHome").innerText = t.home || "Home";

  if (document.getElementById("navDashboard"))
    document.getElementById("navDashboard").innerText = t.dashboard;

  if (document.getElementById("navSubjects"))
    document.getElementById("navSubjects").innerText = t.subjects;

  if (document.getElementById("navProjects"))
    document.getElementById("navProjects").innerText = t.projects;

  if (document.getElementById("navRewards"))
    document.getElementById("navRewards").innerText = t.rewards;

  if (document.getElementById("loginButton"))
    document.getElementById("loginButton").innerText = t.login;

  // üåü NAVBAR (Mobile)
  if (document.getElementById("navHomeMobile"))
    document.getElementById("navHomeMobile").innerText = t.home || "Home";

  if (document.getElementById("loginButtonMobile"))
    document.getElementById("loginButtonMobile").innerText = t.login;

  // üåü LOGIN PAGE
  if (document.getElementById("loginTitle"))
    document.getElementById("loginTitle").innerText = t.loginTitle || "Welcome Back";

  if (document.getElementById("loginSubmitBtn"))
    document.getElementById("loginSubmitBtn").innerText = t.login;

  // üåü SUBJECTS PAGE
  if (document.getElementById("subjectsTitle"))
    document.getElementById("subjectsTitle").innerText = t.subjects;

  // üåü REWARDS PAGE
  if (document.getElementById("rewardsTitle"))
    document.getElementById("rewardsTitle").innerText = t.rewards;

  if (document.getElementById("coinsLabel"))
    document.getElementById("coinsLabel").innerText = t.totalCoins || "Total Coins";
}

</script>

<script>


window.addEventListener('load', function() {
  setTimeout(function() {

    document.getElementById('preloader').style.display = 'none';
    document.getElementById('app').style.display = 'block';

    loadUserData();

    // ü©µ Fix: Make sure Login button works even before authentication
    const authButton = document.getElementById('authButton');
    authButton.addEventListener('click', function() {
      if (!state.isAuthenticated) {
        navigateTo('login');
      } else {
        logout();
      }
    });




  }, 1500);
});



    function loadUserData() {
      var userData = localStorage.getItem('vyatihar_user');
      var coins = localStorage.getItem('vyatihar_coins');
      var projects = localStorage.getItem('vyatihar_projects');
    
      
      if (userData) {
        state.user = JSON.parse(userData);
        state.coins = parseInt(coins || '100');
        state.projects = JSON.parse(projects || '[]');
        updateAuthUI();
      }
    }


    function updateAuthUI() {
      var authButton = document.getElementById('authButton');
      var coinDisplay = document.getElementById('coinDisplay');
      var coinCount = document.getElementById('coinCount');
      
      if (state.isAuthenticated) {
        authButton.textContent = 'Logout';
        authButton.onclick = logout;
        coinDisplay.style.display = 'flex';
        coinCount.textContent = state.coins;
      } else {
        authButton.textContent = 'Login';
        authButton.onclick = function() { navigateTo('login'); };
        coinDisplay.style.display = 'none';
      }
    }

    function logout() {
      state.isAuthenticated = false;
      state.user = null;
      localStorage.removeItem('vyatihar_user');
      updateAuthUI();
      navigateTo('home');
    }

    let authLoaded = false;

// Wait for server session to finish loading
fetch("/api/check-session")
  .then(res => res.json())
  .then(data => {
    if (data.logged_in) {
      state.isAuthenticated = true;
    }
    authLoaded = true;
  });

function navigateTo(page) {
  
// Wait for server auth
  if (!authLoaded) {
      setTimeout(() => navigateTo(page), 50);
      return;
  }

  const protectedPages = ["dashboard", "subjects", "projects", "rewards", "match"];
  
  if (protectedPages.includes(page) && !state.isAuthenticated) {
      window.location.href = "/login";
      return;
  }


  state.currentPage = page;
  var content = document.getElementById('content');
  content.innerHTML = '';
  content.className = 'min-h-screen fade-in';

  if (page === 'home') renderHome();
  else if (page === 'login') renderLogin();
  else if (page === 'signup') renderSignup();
  else if (page === 'dashboard') renderDashboard();
  else if (page === 'subjects') renderSubjects();
  else if (page === 'match') renderMatch();
  else if (page === 'projects') renderProjects();
  else if (page === 'rewards') renderRewards();
  else if (page === "become-teacher") renderBecomeTeacher();
  else if (page === "teacher-dashboard") renderTeacherDashboard();
  else if (page === 'assistant') window.location.href = "/assistant";
  else renderHome();

  setTimeout(() => {
    const saved = localStorage.getItem('vy_lang') || 'en';
    applyLanguage(saved);
  }, 30);
}




    function renderHome() {
      document.getElementById('content').innerHTML = `
        <div class="max-w-7xl mx-auto px-4 py-16">
          <div class="text-center mb-20">
            <!-- inside renderHome() content string replace hero block with this -->
<h1 class="text-6xl font-extrabold mb-6 leading-tight">
  <span id="learnTogetherText" class="text-[#1a1a1a] dark:text-white">Learn Together with</span>
  <span class="bg-gradient-to-r from-purple-600 via-pink-500 to-red-400
    bg-clip-text text-transparent font-extrabold">
    &nbsp;Vyatihar
  </span>
</h1>

<p id="descriptionText" class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
  Where Ideas Meet & Knowledge Grows. Connect with learners and mentors worldwide through AI-powered matchmaking.
</p>

<div class="flex gap-4 justify-center">
  <button id="getStartedBtn" onclick="navigateTo('signup')"
    class="px-8 py-4 gradient-bg text-white rounded-full text-lg font-semibold hover:shadow-2xl transform hover:scale-105 transition">
    Get Started Free
  </button>

  <button id="learnMoreBtn" onclick="document.getElementById('features').scrollIntoView({behavior: 'smooth'})"
    class="px-8 py-4 bg-white text-purple-600 rounded-full text-lg font-semibold border-2 border-purple-600 hover:bg-purple-50 transition">
    Learn More
  </button>
</div>

          </div>

          <div class="grid md:grid-cols-4 gap-6 mb-20">
            <div class="glass rounded-2xl p-6 text-center transform hover:scale-105 transition">
              <div class="text-4xl font-bold text-purple-600">10K+</div>
              <div class="text-gray-600 mt-2">Active Learners</div>
            </div>
            <div class="glass rounded-2xl p-6 text-center transform hover:scale-105 transition">
              <div class="text-4xl font-bold text-pink-600">500+</div>
              <div class="text-gray-600 mt-2">Expert Mentors</div>
            </div>
            <div class="glass rounded-2xl p-6 text-center transform hover:scale-105 transition">
              <div class="text-4xl font-bold text-purple-600">50+</div>
              <div class="text-gray-600 mt-2">Subjects</div>
            </div>
            <div class="glass rounded-2xl p-6 text-center transform hover:scale-105 transition">
              <div class="text-4xl font-bold text-pink-600">98%</div>
              <div class="text-gray-600 mt-2">Satisfaction</div>
            </div>
          </div>

          <div id="features" class="mb-20">
            <h2 class="text-4xl font-bold text-center mb-12">Why Choose Vyatihar?</h2>
            <div class="grid md:grid-cols-3 gap-8">
              <div class="glass rounded-2xl p-8 hover:shadow-2xl transition">
                <div class="text-5xl mb-4">ü§ù</div>
                <h3 class="text-2xl font-bold mb-3">Peer Learning</h3>
                <p class="text-gray-600">Connect with learners worldwide and grow together through collaborative learning.</p>
              </div>
              <div class="glass rounded-2xl p-8 hover:shadow-2xl transition">
                <div class="text-5xl mb-4">‚ú®</div>
                <h3 class="text-2xl font-bold mb-3">AI Matchmaking</h3>
                <p class="text-gray-600">Our AI finds your perfect study partner based on skills, language, and learning goals.</p>
              </div>
              <div class="glass rounded-2xl p-8 hover:shadow-2xl transition">
                <div class="text-5xl mb-4">üèÜ</div>
                <h3 class="text-2xl font-bold mb-3">Earn Rewards</h3>
                <p class="text-gray-600">Get coins and badges for every achievement and contribution to the community.</p>
              </div>
              <div class="glass rounded-2xl p-8 hover:shadow-2xl transition">
                <div class="text-5xl mb-4">üìö</div>
                <h3 class="text-2xl font-bold mb-3">Skill Exchange</h3>
                <p class="text-gray-600">Teach what you know, learn what you need. Exchange skills freely.</p>
              </div>
              <div class="glass rounded-2xl p-8 hover:shadow-2xl transition">
                <div class="text-5xl mb-4">üí¨</div>
                <h3 class="text-2xl font-bold mb-3">24/7 Support</h3>
                <p class="text-gray-600">Get instant help through doubt-solving sessions with mentors and peers.</p>
              </div>
              <div class="glass rounded-2xl p-8 hover:shadow-2xl transition">
                <div class="text-5xl mb-4">üöÄ</div>
                <h3 class="text-2xl font-bold mb-3">Project Incubation</h3>
                <p class="text-gray-600">Pitch ideas, form teams, and bring your projects to life with mentorship.</p>
              </div>
            </div>
          </div>

          <div class="mb-20">
            <h2 class="text-4xl font-bold text-center mb-12">What Our Users Say</h2>
            <div class="grid md:grid-cols-3 gap-6">
             <div class="glass rounded-2xl p-6 testimonial-card">
  <div class="flex items-center gap-3 mb-4">
    <div class="w-12 h-12 gradient-bg rounded-full flex items-center justify-center text-white text-xl">R</div>
    <div>
      <div class="user-name">Rahul Kumar</div>
      <div class="text-sm text-gray-600 dark:text-gray-300">Student</div>
    </div>
  </div>

                <div class="text-yellow-500 mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="text-gray-600">"Vyatihar helped me find amazing study partners. The AI matching is incredibly accurate!"</p>
              </div>
              <div class="glass rounded-2xl p-6">
                <div class="flex items-center gap-3 mb-4">
                  <div class="w-12 h-12 gradient-bg rounded-full flex items-center justify-center text-white text-xl">P</div>
                  <div>
                    <div class="font-bold">Priya Sharma</div>
                    <div class="text-sm text-gray-600">Mentor</div>
                  </div>
                </div>
                <div class="text-yellow-500 mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="text-gray-600">"As a mentor, I love helping others learn. The platform makes it easy and rewarding!"</p>
              </div>
              <div class="glass rounded-2xl p-6">
                <div class="flex items-center gap-3 mb-4">
                  <div class="w-12 h-12 gradient-bg rounded-full flex items-center justify-center text-white text-xl">A</div>
                  <div>
                    <div class="font-bold">Aisha Khan</div>
                    <div class="text-sm text-gray-600">Professional</div>
                  </div>
                </div>
                <div class="text-yellow-500 mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="text-gray-600">"The gamification keeps me motivated. I've earned so many badges while learning!"</p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderLogin() {
      document.getElementById('content').innerHTML = `
        <div class="max-w-md mx-auto px-4 py-16">
          <div class="glass rounded-3xl shadow-2xl p-8">
            <div class="text-center mb-8">
              <div class="w-20 h-20 gradient-bg rounded-2xl flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4">V</div>
              <h2 id="loginTitle" class="text-3xl font-bold">Welcome Back</h2>
              <p class="text-gray-600 mt-2">Login to continue your learning journey</p>
            </div>
            <form method="POST" action="/login" onsubmit="loginSuccess()" class="space-y-4">


  <input name="email" type="email" placeholder="Email" required
    class="w-full px-4 py-3 rounded-lg border border-gray-300 
    focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition">

  <input name="password" type="password" placeholder="Password" required
    class="w-full px-4 py-3 rounded-lg border border-gray-300 
    focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition">

  <button type="submit" 
    class="w-full py-3 gradient-bg text-white rounded-lg font-semibold hover:shadow-lg transition">
    Log In
  </button>

</form>

            <p class="text-center mt-6 text-gray-600">
              Don't have an account? <button onclick="navigateTo('signup')" class="text-purple-600 font-semibold hover:underline">Sign up</button>
            </p>
          </div>
        </div>
      `;
    }



    function renderSignup() {
      document.getElementById('content').innerHTML = `
        <div class="max-w-md mx-auto px-4 py-16">
          <div class="glass rounded-3xl shadow-2xl p-8">
            <div class="text-center mb-8">
              <h2 class="text-3xl font-bold">Join Vyatihar</h2>
              <p class="text-gray-600 mt-2">Create your free account</p>
            </div>
           <form method="POST" action="/signup" class="space-y-4">

  <input name="username" type="text" placeholder="Full Name" required
    class="w-full px-4 py-3 rounded-lg border border-gray-300 
    focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition">

  <input name="email" type="email" placeholder="Email" required
    class="w-full px-4 py-3 rounded-lg border border-gray-300 
    focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition">

  <input name="password" type="password" placeholder="Password" required
    class="w-full px-4 py-3 rounded-lg border border-gray-300 
    focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition">

  <button type="submit"
    class="w-full py-3 gradient-bg text-white rounded-lg font-semibold hover:shadow-lg transition">
    Create Account
  </button>

</form>

            <p class="text-center mt-6 text-gray-600">
              Already have an account? <button onclick="navigateTo('login')" class="text-purple-600 font-semibold hover:underline">Log in</button>
            </p>
          </div>
        </div>
      `;
    }


    function renderSubjects() {

  // üîê Require login for this page
  if (!state.isAuthenticated) {
    navigateTo("login");
    return;
  }

      var subjectsHTML = '';
      for (var i = 0; i < state.subjects.length; i++) {
        var subject = state.subjects[i];
        subjectsHTML += `
         <div class="glass rounded-2xl p-6 hover:shadow-2xl transition transform hover:scale-105 relative">
  <span id="live-${subject.name}" class="absolute top-4 right-4 hidden bg-red-500 text-white text-xs px-2 py-1 rounded-full">LIVE</span>

            <div class="text-5xl mb-4">${subject.icon}</div>
            <h3 class="text-2xl font-bold mb-2">${subject.name}</h3>
            <p class="text-gray-600 text-sm mb-4">${subject.description}</p>
            <div class="mb-4">
              <div class="flex justify-between text-sm mb-1">
                <span class="text-gray-600">Progress</span>
                <span class="font-semibold">${subject.progress}%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="gradient-bg h-2 rounded-full transition-all" style="width: ${subject.progress}%"></div>
              </div>
            </div>
            <div class="flex items-center justify-between mb-4">
              <span class="text-sm text-gray-600">${subject.students} students</span>
              <span class="text-sm font-semibold text-purple-600">View Course</span>
            </div>
          <div class="flex flex-col gap-3">
  <button id="continueLearningBtn" class="w-full py-3 gradient-bg text-white rounded-lg font-semibold hover:shadow-lg transition">
    Continue Learning
  </button>
  <button id="startLiveBtn" onclick="startLiveClass('${subject.name}')" 
    class="w-full py-3 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
    üî¥ Start Live Class
  </button>
    <button onclick="uploadRecording('${subject.name}')"
    class="w-full py-2 bg-gray-700 text-white rounded-lg font-semibold hover:bg-gray-800 transition">
    üì§ Upload Recording To Drive
  </button>

</div>

          </div>
        `;
      }

      document.getElementById('content').innerHTML = `
        <div class="max-w-7xl mx-auto px-4 py-8">
          <div class="mb-8">
            <h1 id="subjectsTitle" class="text-4xl font-bold">Explore Subjects</h1>
            <p class="text-gray-600 mt-2">Choose a subject to start your learning journey</p>
          </div>
          <div class="grid md:grid-cols-3 gap-6">
            ${subjectsHTML}
          </div>
        </div>
      `;
    }

    function renderRewards() {

  // üîê Require login
  if (!state.isAuthenticated) {
    navigateTo("login");
    return;
  }
      var matchesHTML = '';
      for (var i = 0; i < state.matches.length; i++) {
        var match = state.matches[i];
        matchesHTML += `
          <div class="glass rounded-2xl p-6 hover:shadow-xl transition">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-16 h-16 gradient-bg rounded-full flex items-center justify-center text-white text-3xl">${match.image}</div>
              <div class="flex-1">
                <h3 class="text-xl font-bold">${match.name}</h3>
                <p class="text-sm text-gray-600">${match.skill}</p>
                <div class="flex items-center gap-2 mt-1">
                  <span class="text-yellow-500">‚≠ê</span>
                  <span class="text-sm font-semibold">${match.rating}</span>
                  <span class="text-sm text-gray-600">‚Ä¢ ${match.language}</span>
                </div>
              </div>
            </div>
            <p class="text-gray-600 text-sm mb-4">${match.bio}</p>
            <button onclick="connectWithMatch('${match.name}')" class="w-full py-2 gradient-bg text-white rounded-lg hover:shadow-lg transition">
              Connect Now
            </button>
          </div>
        `;
      }

      document.getElementById('content').innerHTML = `
        <div class="max-w-7xl mx-auto px-4 py-8">
          <div class="mb-8">
            <h1 class="text-4xl font-bold">AI Matchmaking</h1>
            <p class="text-gray-600 mt-2">Find your perfect study partner</p>
          </div>

          <div class="glass rounded-2xl p-6 mb-8">
            <h3 class="text-xl font-bold mb-4">Filter Your Match</h3>
            <div class="grid md:grid-cols-3 gap-4">
              <select class="px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none">
                <option>Select Subject</option>
                <option>Finance</option>
                <option>Marketing</option>
                <option>AI & ML</option>
                <option>Web Development</option>
                <option>Data Science</option>
                <option>Design</option>
              </select>
              <select class="px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none">
                <option>Preferred Language</option>
                <option>English</option>
                <option>Hindi</option>
                <option>Tamil</option>
                <option>Telugu</option>
                <option>Marathi</option>
              </select>
              <select class="px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none">
                <option>Learning Style</option>
                <option>Visual Learner</option>
                <option>Hands-on Practice</option>
                <option>Discussion-based</option>
                <option>Self-paced</option>
              </select>
            </div>
            <button class="mt-4 px-6 py-3 gradient-bg text-white rounded-lg hover:shadow-lg transition">
              Find Matches
            </button>
          </div>

          <h2 class="text-2xl font-bold mb-6">Recommended Matches</h2>
          <div class="grid md:grid-cols-2 gap-6">
            ${matchesHTML}
          </div>
        </div>
      `;
    }

    function connectWithMatch(name) {
      alert('Connection request sent to ' + name + '! They will be notified.');
    }

    function renderProjects() {

  // üîê Require login
  if (!state.isAuthenticated) {
    navigateTo("login");
    return;
  }
      var projectsHTML = '';
      for (var i = 0; i < state.projects.length; i++) {
        var project = state.projects[i];
        projectsHTML += `
          <div class="glass rounded-2xl p-6 mb-4">
            <h3 class="text-xl font-bold mb-2">${project.title}</h3>
            <p class="text-gray-600 mb-4">${project.description}</p>
            <div class="flex gap-2">
              <button class="px-4 py-2 gradient-bg text-white rounded-lg hover:shadow-lg transition">View Details</button>
              <button class="px-4 py-2 border-2 border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 transition">Join Team</button>
            </div>
          </div>
        `;
      }

      document.getElementById('content').innerHTML = `
        <div class="max-w-7xl mx-auto px-4 py-8">
          <div class="mb-8">
            <h1 class="text-4xl font-bold">Collaborative Projects</h1>
            <p class="text-gray-600 mt-2">Pitch ideas, form teams, and build together</p>
          </div>

          <div class="glass rounded-2xl p-6 mb-8">
            <h3 class="text-xl font-bold mb-4">Create New Project</h3>
            <form onsubmit="handleCreateProject(event)" class="space-y-4">
              <input type="text" id="projectTitle" placeholder="Project Title" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition">
              <textarea id="projectDescription" placeholder="Project Description" rows="4" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition"></textarea>
              <button type="submit" class="px-6 py-3 gradient-bg text-white rounded-lg hover:shadow-lg transition">
                Create Project
              </button>
            </form>
          </div>

          <h2 class="text-2xl font-bold mb-6">Active Projects</h2>
          ${projectsHTML.length > 0 ? projectsHTML : '<p class="text-gray-600">No projects yet. Be the first to create one!</p>'}
        </div>
      `;
    }

    function handleCreateProject(e) {
      e.preventDefault();
      var title = document.getElementById('projectTitle').value;
      var description = document.getElementById('projectDescription').value;
      
      var newProject = {
        id: Date.now(),
        title: title,
        description: description,
        createdAt: new Date().toISOString()
      };
      
      state.projects.push(newProject);
      localStorage.setItem('vyatihar_projects', JSON.stringify(state.projects));
      renderProjects();
    }

    function renderRewards() {
      document.getElementById('content').innerHTML = `
        <div class="max-w-7xl mx-auto px-4 py-8">
          <div class="mb-8">
            <h1 id="rewardsTitle"class="text-4xl font-bold">Rewards & Achievements</h1>
            <p class="text-gray-600 mt-2">Track your progress and earn rewards</p>
          </div>

          <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold mb-4">Your Coins</h3>
              <div class="text-center py-8">
                <div class="text-6xl mb-4">ü™ô</div>
                <div class="text-5xl font-bold text-yellow-600 mb-2">${state.coins}</div>
                <p id="coinsSectionLabel" class="text-gray-600">Total Coins Earned</p>
              </div>
              <button onclick="earnCoins()" class="w-full py-3 gradient-bg text-white rounded-lg hover:shadow-lg transition">
                Complete Task (+10 Coins)
              </button>
            </div>

            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold mb-4">Your Badges</h3>
              <div class="grid grid-cols-3 gap-4">
                <div class="text-center p-4 bg-gradient-to-br from-yellow-100 to-yellow-200 rounded-xl">
                  <div class="text-4xl mb-2">üèÜ</div>
                  <p class="text-xs font-semibold">Top Learner</p>
                </div>
                <div class="text-center p-4 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                  <div class="text-4xl mb-2">‚≠ê</div>
                  <p class="text-xs font-semibold">5-Star Helper</p>
                </div>
                <div class="text-center p-4 bg-gradient-to-br from-red-100 to-red-200 rounded-xl">
                  <div class="text-4xl mb-2">üî•</div>
                  <p class="text-xs font-semibold">7-Day Streak</p>
                </div>
                <div class="text-center p-4 bg-gradient-to-br from-green-100 to-green-200 rounded-xl">
                  <div class="text-4xl mb-2">üìö</div>
                  <p class="text-xs font-semibold">Bookworm</p>
                </div>
                <div class="text-center p-4 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl">
                  <div class="text-4xl mb-2">ü§ù</div>
                  <p class="text-xs font-semibold">Team Player</p>
                </div>
                <div class="text-center p-4 bg-gradient-to-br from-pink-100 to-pink-200 rounded-xl">
                  <div class="text-4xl mb-2">üéØ</div>
                  <p class="text-xs font-semibold">Goal Crusher</p>
                </div>
              </div>
            </div>
          </div>

          <div class="glass rounded-2xl p-6 mb-8">
            <h3 class="text-xl font-bold mb-4">Leaderboard</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-4 bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-lg">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold text-xl">1</div>
                  <div>
                    <div class="font-bold">Rahul Kumar</div>
                    <div class="text-sm text-gray-600">Computer Science</div>
                  </div>
                </div>
                <div class="text-2xl font-bold text-yellow-600">850 ü™ô</div>
              </div>
              <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 bg-gray-400 rounded-full flex items-center justify-center text-white font-bold text-xl">2</div>
                  <div>
                    <div class="font-bold">Priya Sharma</div>
                    <div class="text-sm text-gray-600">Marketing</div>
                  </div>
                </div>
                <div class="text-2xl font-bold text-gray-600">720 ü™ô</div>
              </div>
              <div class="flex items-center justify-between p-4 bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 bg-orange-400 rounded-full flex items-center justify-center text-white font-bold text-xl">3</div>
                  <div>
                    <div class="font-bold">${state.user ? state.user.name : 'You'}</div>
                    <div class="text-sm text-gray-600">Web Development</div>
                  </div>
                </div>
                <div class="text-2xl font-bold text-orange-600">${state.coins} ü™ô</div>
              </div>
            </div>
          </div>

          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-4">How to Earn Coins</h3>
            <div class="grid md:grid-cols-3 gap-4">
              <div class="text-center p-4">
                <div class="text-4xl mb-2">üìù</div>
                <div class="font-semibold mb-1">Complete Lessons</div>
                <div class="text-sm text-gray-600">+5 coins per lesson</div>
              </div>
              <div class="text-center p-4">
                <div class="text-4xl mb-2">ü§ù</div>
                <div class="font-semibold mb-1">Help Others</div>
                <div class="text-sm text-gray-600">+10 coins per session</div>
              </div>
              <div class="text-center p-4">
                <div class="text-4xl mb-2">‚úÖ</div>
                <div class="font-semibold mb-1">Daily Login</div>
                <div class="text-sm text-gray-600">+2 coins per day</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }


    function earnCoins() {
      state.coins += 10;
      localStorage.setItem('vyatihar_coins', state.coins.toString());
      updateAuthUI();
      renderRewards();
      alert('Congratulations! You earned 10 coins! üéâ');
    }
    // üåô Dark Mode Toggle Script
const themeToggle = document.getElementById('themeToggle');
const html = document.documentElement;

// Load saved theme
if (localStorage.getItem('theme') === 'dark') {
  html.classList.add('dark');
  themeToggle.textContent = '‚òÄÔ∏è';
}

// Listen for toggle
themeToggle.addEventListener('click', () => {
  if (html.classList.contains('dark')) {
    html.classList.remove('dark');
    localStorage.setItem('theme', 'light');
    themeToggle.textContent = 'üåô';
  } else {
    html.classList.add('dark');
    localStorage.setItem('theme', 'dark');
    themeToggle.textContent = '‚òÄÔ∏è';
  }
});

// üß≠ Navbar scroll shadow toggle
window.addEventListener('scroll', () => {
  const nav = document.getElementById('mainNav');
  if (window.scrollY > 10) {
    nav.classList.add('scrolled');
  } else {
    nav.classList.remove('scrolled');
  }
});

// ü©µ GOOGLE LOGIN SETUP
function initGoogleLogin() {
  google.accounts.id.initialize({
    client_id: "882114584507-jpb714h63kb2jgfkg3omq1fsjnu0a15l.apps.googleusercontent.com",
    callback: handleGoogleLogin,
  });

  google.accounts.id.renderButton(
    document.getElementById("googleLoginButton"),
    { theme: "outline", size: "large" }
  );
}

function handleGoogleLogin(response) {
  const user = jwt_decode(response.credential);
  console.log("Google user:", user);
  localStorage.setItem("google_user", JSON.stringify(user));
  alert(`Welcome ${user.name}! You can now start live classes.`);
}


// Generate Google Meet Link Using Calendar API

async function startLiveClass(subjectName) {
  const token = localStorage.getItem("google_access_token");
  if (!token) {
    alert("Please login with Google first!");
    return;
  }

  const event = {
    summary: `${subjectName} Live Class`,
    description: `Live class for ${subjectName} on Vyatihar`,
    start: { dateTime: new Date().toISOString(), timeZone: "Asia/Kolkata" },
    end: { dateTime: new Date(Date.now() + 60 * 60 * 1000).toISOString(), timeZone: "Asia/Kolkata" },
    conferenceData: { createRequest: { requestId: `meet-${Date.now()}` } },
  };

  const response = await fetch(
    "https://www.googleapis.com/calendar/v3/calendars/primary/events?conferenceDataVersion=1",
    {
      method: "POST",
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify(event),
    }
  );

  const data = await response.json();
  if (data.hangoutLink) {
    alert(`Class Created! Join here:\n${data.hangoutLink}`);
    saveClassToDrive(subjectName, data.hangoutLink);
    document.getElementById(`live-${subjectName}`).classList.remove("hidden");
  } else {
    console.log(data);
    alert("Error creating class. Try again.");
  }
}

// Save Class Info to Google Drive

async function saveClassToDrive(subject, meetLink) {
  try {
    const token = localStorage.getItem("google_access_token");

    if (!token) {
      console.log("Google Login required");
      return;
    }

    const metadata = {
      name: `${subject}-class-${new Date().toISOString().slice(0, 10)}.txt`,
      mimeType: "text/plain"
    };

    const file = new Blob(
      [
        `Subject: ${subject}\n` +
        `Meet Link: ${meetLink}\n` +
        `Uploaded: ${new Date().toLocaleString()}`
      ],
      { type: "text/plain" }
    );

    const form = new FormData();
    form.append(
      "metadata",
      new Blob([JSON.stringify(metadata)], { type: "application/json" })
    );
    form.append("file", file);

    const res = await fetch(
      "https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",
      {
        method: "POST",
        headers: new Headers({ Authorization: "Bearer " + token }),
        body: form,
      }
    );

    const data = await res.json();
    console.log("Class saved in Drive:", data);

  } catch (err) {
    console.error("Drive upload error:", err);
  }
}


// üåê GOOGLE DRIVE API SETUP
function loadGoogleAPI() {
  gapi.load('client:auth2', initClient);
}

function initClient() {
  gapi.client.init({
    apiKey: 'AIzaSyBjTJb1d46Cc1qhhhUOFa0vtQQie0R0ulU',
    clientId: '882114584507-jpb714h63kb2jgfkg3omq1fsjnu0a15l.apps.googleusercontent.com',
    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    scope: 'https://www.googleapis.com/auth/drive.file'
  }).then(() => {
    console.log('‚úÖ Google API Ready');
  }, (error) => {
    console.error('Google API Error:', error);
  });
}



// Add Function to Upload File to Drive

async function uploadRecording(subjectName) {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'video/*';

  fileInput.onchange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const metadata = {
      name: `${subjectName}_Class_${new Date().toISOString().split('T')[0]}.mp4`,
      mimeType: file.type
    };

    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
    form.append('file', file);

    const token = gapi.auth.getToken().access_token;
    const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
      method: 'POST',
      headers: new Headers({ 'Authorization': 'Bearer ' + token }),
      body: form
    });

    const data = await res.json();
    alert(`‚úÖ Recording uploaded successfully to Drive!\nFile ID: ${data.id}`);
  };

  fileInput.click();
}


// ---------- Google Drive init ----------
function loadGoogleAPI() {
  // loads gapi libs
  gapi.load('client:auth2', initClient);
}

function initClient() {
  gapi.client.init({
    apiKey: "AIzaSyBjTJb1d46Cc1qhhhUOFa0vtQQie0R0ulU",
    clientId: "882114584507-jpb714h63kb2jgfkg3omq1fsjnu0a15l.apps.googleusercontent.com",
    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    scope: 'https://www.googleapis.com/auth/drive.file'
  }).then(() => {
    console.log('Google API initialized');
  }).catch(err => {
    console.error('gapi init error', err);
  });
}

// call loader after page load (safe if you already have window.onload)
window.addEventListener('load', loadGoogleAPI);

// ---------- Sign in handler (connect Drive) ----------
async function handleGoogleSignIn() {
  try {
    const auth = gapi.auth2.getAuthInstance();
    if (!auth) {
      alert('Google API not ready yet ‚Äî refresh the page and try again.');
      return;
    }
    await auth.signIn(); // shows consent prompt
    const user = auth.currentUser.get();
    const token = user.getAuthResponse().access_token;
    if (token) {
      alert('‚úÖ Google Drive connected successfully!');
    } else {
      alert('‚ö†Ô∏è Could not get token. Try again.');
    }
  } catch (err) {
    console.error(err);
    alert('Sign-in failed. Check console for details.');
  }
}




// ---------- Upload recording to Drive ----------
async function uploadRecording(subjectName) {
  const auth = gapi.auth2 && gapi.auth2.getAuthInstance();
  if (!auth || !auth.isSignedIn.get()) {
    alert('Please connect your Google Drive first (üîê Connect Google Drive).');
    return;
  }

  // choose file
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'video/*';

  fileInput.onchange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    // metadata
    const metadata = {
      name: `${subjectName}_Class_${new Date().toISOString().slice(0,10)}${file.name.substring(file.name.lastIndexOf('.'))}`,
      mimeType: file.type
    };

    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
    form.append('file', file);

    try {
      const token = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
      const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
        method: 'POST',
        headers: new Headers({ 'Authorization': 'Bearer ' + token }),
        body: form
      });
      const data = await res.json();
      if (data && data.id) {
        alert(`‚úÖ Recording uploaded! File ID: ${data.id}`);
      } else {
        console.error('Drive upload response', data);
        alert('‚ùå Upload failed ‚Äî check console for details.');
      }
    } catch (err) {
      console.error('Upload error', err);
      alert('Upload error ‚Äî check console for details.');
    }
  };

  fileInput.click();
}

async function checkTeacherStatus() {
  const res = await fetch("/api/teacher/me");
  const data = await res.json();

  if (!data.error) {
    document.getElementById("teacherDashboardBtn").classList.remove("hidden");
  }
}
checkTeacherStatus();


function loginSuccess() {
    setTimeout(() => {
        fetch("/api/me")
          .then(r => r.json())
          .then(u => {
              localStorage.setItem("vyatihar_user", JSON.stringify(u));
              state.user = u;
              state.isAuthenticated = true;
          });
    }, 500);
}

</script>


<!-- Add these functions in your main script (index.html) -->
<script>
/* ---- Helper: small glass card template ---- */
function teacherCardHTML(t) {
  // t: {id, name, subjects, qualifications, experience_years, bio, verified}
  return `
  <div class="glass rounded-2xl p-5 hover:shadow-2xl transition transform hover:-translate-y-1">
    <div class="flex items-start gap-4">
      <div class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center text-white text-xl">
        ${t.name ? t.name.charAt(0).toUpperCase() : 'T'}
      </div>
      <div class="flex-1">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-bold text-lg">${t.name}</div>
            <div class="text-sm text-gray-600 mt-1">${t.subjects || '‚Äî'}</div>
          </div>
          <div class="text-sm ${t.verified ? 'text-green-400' : 'text-gray-400'}">
            ${t.verified ? 'Verified' : 'Unverified'}
          </div>
        </div>
        <p class="text-sm text-gray-600 mt-3 line-clamp-3">${t.bio || ''}</p>
        <div class="flex gap-2 mt-4">
          <button onclick="viewTeacher(${t.id})" class="px-4 py-2 rounded-full border border-purple-600 text-purple-600">View</button>
          <button onclick="toggleSaveTeacher(${t.id}, this)" class="px-4 py-2 rounded-full bg-purple-600 text-white">Save</button>
        </div>
      </div>
    </div>
  </div>
  `;
}

/* ---- render teachers list ---- */
async function renderTeachers() {
  document.getElementById('content').innerHTML = `
    <div class="max-w-6xl mx-auto px-4 py-8">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">Top Teachers</h1>
        <div>
          <input id="teacherSearch" placeholder="Search name, subject, qualification" class="px-3 py-2 rounded-lg border"/>
          <button onclick="loadTeachers()" class="ml-2 px-4 py-2 bg-purple-600 text-white rounded-lg">Search</button>
        </div>
      </div>
      <div id="teachersGrid" class="grid md:grid-cols-3 gap-6"></div>
    </div>
  `;
  await loadTeachers();
}

async function loadTeachers() {
  const q = document.getElementById('teacherSearch') ? document.getElementById('teacherSearch').value : '';
  const url = '/api/teachers' + (q ? '?q=' + encodeURIComponent(q) : '');
  const res = await fetch(url);
  const data = await res.json();
  const grid = document.getElementById('teachersGrid');
  grid.innerHTML = '';
  data.forEach(t => grid.insertAdjacentHTML('beforeend', teacherCardHTML(t)));
}

/* ---- view single teacher ---- */
async function viewTeacher(id) {
  const res = await fetch('/api/teacher/' + id);
  const t = await res.json();
  document.getElementById('content').innerHTML = `
    <div class="max-w-4xl mx-auto px-4 py-8">
      <div class="glass p-6 rounded-2xl">
        <div class="flex items-start gap-6">
          <div class="w-28 h-28 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center text-white text-3xl">
            ${t.name ? t.name.charAt(0).toUpperCase() : 'T'}
          </div>
          <div class="flex-1">
            <h2 class="text-2xl font-bold">${t.name} <span class="text-sm ml-2 ${t.verified?'text-green-400':'text-gray-400'}">${t.verified ? 'Verified' : ''}</span></h2>
            <p class="text-gray-600 mt-2">${t.qualifications || ''}</p>
            <p class="text-gray-600 mt-2">Subjects: ${t.subjects || '‚Äî'}</p>
            <p class="text-gray-600 mt-2">Experience: ${t.experience_years || 0} yrs</p>
            <div class="mt-4 flex gap-3">
              <button onclick="openBookingModal(${t.id})" class="px-5 py-2 bg-gradient-to-br from-purple-600 to-pink-400 text-white rounded-full">Book Class</button>
              <button onclick="toggleSaveTeacher(${t.id}, this)" class="px-5 py-2 border rounded-full">Save</button>
            </div>
          </div>
        </div>

        <div class="mt-6">
          <h3 class="font-semibold">About</h3>
          <p class="text-gray-700 mt-2">${t.bio || ''}</p>
        </div>
      </div>
    </div>
  `;
}

/* ---- save teacher ---- */
async function toggleSaveTeacher(teacherId, el) {
  const res = await fetch('/api/teacher/save', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({teacher_id: teacherId})
  });
  const j = await res.json();
  if (j.ok) {
    el && (el.textContent = j.saved ? 'Unsave' : 'Save');
    alert(j.saved ? 'Saved' : 'Removed from saved');
  } else {
    alert(j.error || 'Login required');
  }
}

/* ---- booking modal + create booking ---- */
function openBookingModal(teacherId) {
  const modalHtml = `
    <div id="booking-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
      <div class="bg-white rounded-2xl p-6 w-full max-w-md">
        <h3 class="text-xl font-bold mb-3">Book Class</h3>
        <input id="booking-subject" placeholder="Subject / Topic" class="w-full px-3 py-2 border rounded mb-3"/>
        <input id="booking-time" type="datetime-local" class="w-full px-3 py-2 border rounded mb-3"/>
        <div class="flex gap-2 justify-end">
          <button onclick="createBooking(${teacherId})" class="px-4 py-2 bg-purple-600 text-white rounded">Send Request</button>
          <button onclick="document.getElementById('booking-modal').remove()" class="px-4 py-2 border rounded">Cancel</button>
        </div>
      </div>
    </div>
  `;
  document.body.insertAdjacentHTML('beforeend', modalHtml);
}

async function createBooking(teacherId) {
  const subject = document.getElementById('booking-subject').value;
  const t = document.getElementById('booking-time').value;
  const res = await fetch('/api/teacher/book', {
    method:'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({teacher_id: teacherId, subject: subject, requested_time: t})
  });
  const j = await res.json();
  if (j.ok) {
    alert('Booking request sent!');
    document.getElementById('booking-modal')?.remove();
  } else {
    alert(j.error || 'Error sending request');
  }
}

/* ---- become teacher form ---- */
function renderBecomeTeacher() {
  document.getElementById('content').innerHTML = `
    <div class="max-w-3xl mx-auto px-4 py-8">
      <div class="glass p-6 rounded-2xl">
        <h2 class="text-2xl font-bold mb-4">Become a Teacher</h2>
        <form id="becomeTeacherForm" onsubmit="submitBecomeTeacher(event)">
          
          <textarea name="bio" id="bt-bio" placeholder="Short bio" 
            class="w-full border p-3 rounded mb-3"></textarea>

          <input name="qualifications" id="bt-qual" placeholder="Qualifications" 
            class="w-full border p-3 rounded mb-3" />

          <input name="subjects" id="bt-sub" placeholder="Subjects (comma separated)" 
            class="w-full border p-3 rounded mb-3" />

          <input name="experience_years" id="bt-exp" placeholder="Experience years" 
            type="number" class="w-full border p-3 rounded mb-3" />

          <div class="flex gap-2 justify-end">
            <button class="px-5 py-2 bg-purple-600 text-white rounded">
              Apply
            </button>
          </div>
        </form>
      </div>
    </div>
  `;
}


async function submitBecomeTeacher(e) {
  e.preventDefault();
  const form = document.getElementById('becomeTeacherForm');
  const fd = new FormData(form);
  const res = await fetch('/api/teacher/become', {method:'POST', body: fd});
  const j = await res.json();
  if (j.ok) {
    alert('Application submitted!');
    navigateTo('teachers');
  } else {
    alert(j.error || 'Error');
  }
}

/* ---- teacher dashboard (for logged-in teachers) ---- */
async function renderTeacherDashboard() {
  document.getElementById('content').innerHTML = `
    <div class="max-w-5xl mx-auto px-4 py-8">
      <h1 class="text-2xl font-bold mb-4">Teacher Dashboard</h1>
      <div id="teacherBookings"></div>
    </div>
  `;
  const res = await fetch('/api/teacher/bookings');
  const j = await res.json();
  if (j.error) {
    document.getElementById('teacherBookings').innerHTML = '<div class="glass p-6 rounded">Please apply and login as teacher to see bookings.</div>';
    return;
  }
  const container = document.getElementById('teacherBookings');
  container.innerHTML = '';
  j.forEach(b => {
    container.insertAdjacentHTML('beforeend', `
      <div class="glass p-4 rounded mb-3 flex items-center justify-between">
        <div>
          <div class="font-bold">${b.student_name}</div>
          <div class="text-sm text-gray-600">${b.subject} ‚Ä¢ ${b.requested_time || 'Anytime'}</div>
        </div>
        <div class="flex gap-2">
          <button onclick="teacherAction(${b.id}, 'accept')" class="px-3 py-2 bg-green-500 text-white rounded">Accept</button>
          <button onclick="teacherAction(${b.id}, 'reject')" class="px-3 py-2 bg-red-500 text-white rounded">Reject</button>
        </div>
      </div>
    `);
  });
}

async function teacherAction(id, action) {
  const res = await fetch('/api/teacher/booking/' + id + '/action', {
    method:'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({action})
  });
  const j = await res.json();
  if (j.ok) {
    alert('Updated: ' + j.status);
    renderTeacherDashboard();
  } else {
    alert(j.error || 'Error');
  }
}

/* ---- add navigation mapping for SPA ---- */
const originalNavigateTo = window.navigateTo || function(p){ console.log('no navigateTo'); };
window.navigateTo = function(page, id){
  if(page === 'teachers') return renderTeachers();
  if(page === 'teacher-profile') return viewTeacher(id);
  if(page === 'become-teacher') return renderBecomeTeacher();
  if(page === 'teacher-dashboard') return renderTeacherDashboard();
  return originalNavigateTo(page);
}

/* optional: auto-link buttons (call navigateTo('teachers') where you want) */
</script>



<script>
async function renderTeacherDashboard() {

  document.getElementById('content').innerHTML = `
    <div class="max-w-4xl mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold mb-6">üë®‚Äçüè´ Teacher Dashboard</h1>

      <div id="teacherProfileBox" class="mb-8 p-4 bg-white shadow rounded-lg">
        Loading your teacher profile...
      </div>

      <div id="teacherBookingsBox" class="p-4 bg-white shadow rounded-lg">
        Loading your bookings...
      </div>
    </div>
  `;

  loadTeacherProfile();
  loadTeacherBookings();
}

async function loadTeacherProfile() {
  try {
    const res = await fetch("/api/teacher/me");
    const data = await res.json();

    if (data.error) {
      document.getElementById("teacherProfileBox").innerHTML =
        "<p style='color:red;'>You are not a teacher yet.</p>";
      return;
    }

    document.getElementById("teacherProfileBox").innerHTML = `
      <h2 class="text-xl font-semibold mb-2">Your Profile</h2>
      <p><b>Name:</b> ${data.name}</p>
      <p><b>Bio:</b> ${data.bio || "Not added"}</p>
      <p><b>Subjects:</b> ${data.subjects || "Not added"}</p>
      <p><b>Experience:</b> ${data.experience_years} years</p>
      <p><b>Availability:</b> ${data.availability}</p>
    `;
  } catch (err) {
    console.error(err);
  }
}

async function loadTeacherBookings() {
  try {
    const res = await fetch("/api/teacher/bookings");
    const data = await res.json();

    if (data.error) {
      document.getElementById("teacherBookingsBox").innerHTML =
        "<p style='color:red;'>No bookings found.</p>";
      return;
    }

    let html = "<h2 class='text-xl font-semibold mb-2'>Student Bookings</h2>";

    if (data.length === 0) {
      html += "<p>No bookings yet.</p>";
    } else {
      data.forEach(b => {
        html += `
          <div class="border p-3 rounded-lg mb-2">
            <p><b>Student:</b> ${b.student_name}</p>
            <p><b>Subject:</b> ${b.subject}</p>
            <p><b>Status:</b> ${b.status}</p>
            <p><b>Time:</b> ${b.requested_time || "Not set"}</p>
          </div>
        `;
      });
    }

    document.getElementById("teacherBookingsBox").innerHTML = html;

  } catch (err) {
    console.error(err);
  }
}
</script>

<script>
  // Apply translated strings to elements with specific IDs
  function applyLanguage(lang) {
    const t = translations[lang] || translations['en'];

    // Home page
    const elLearn = document.getElementById('learnTogetherText');
    if (elLearn) elLearn.innerText = t.learnTogether;

    const elDesc = document.getElementById('descriptionText');
    if (elDesc) elDesc.innerText = t.description;

    const btnStart = document.getElementById('getStartedBtn');
    if (btnStart) btnStart.innerText = t.getStarted;

    const btnLearn = document.getElementById('learnMoreBtn');
    if (btnLearn) btnLearn.innerText = t.learnMore;

    // Navbar / buttons
    const loginBtns = document.querySelectorAll('.loginBtn');
    loginBtns.forEach(b => b.innerText = t.login);

    // Enable sound label (if you have a button)
    const enableSoundBtn = document.getElementById('enable-sound');
    if (enableSoundBtn) enableSoundBtn.innerText = t.enableSound;
  }

  // When user changes language in the desktop select
  const langSelect = document.getElementById('languageSelect');
  if (langSelect) {
    langSelect.addEventListener('change', function() {
      const lang = this.value;
      localStorage.setItem('vy_lang', lang);
      applyLanguage(lang);
      // Mirror mobile select (if present)
      const m = document.getElementById('languageSelectMobile');
      if (m) m.value = lang;
    });
  }

  // Mobile select
  const langSelectMobile = document.getElementById('languageSelectMobile');
  if (langSelectMobile) {
    langSelectMobile.addEventListener('change', function() {
      const lang = this.value;
      localStorage.setItem('vy_lang', lang);
      applyLanguage(lang);
      const d = document.getElementById('languageSelect');
      if (d) d.value = lang;
    });
  }

  // Load saved language on page load
  window.addEventListener('load', () => {
    const saved = localStorage.getItem('vy_lang') || 'en';
    const d = document.getElementById('languageSelect');
    if (d) d.value = saved;
    const m = document.getElementById('languageSelectMobile');
    if (m) m.value = saved;
    applyLanguage(saved);
  });
</script>

<!-- üîä Enable Sound Button -->
<button id="enable-sound" 
  class="fixed bottom-5 right-5 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-700">
  üîä Enable Sound Alerts
</button>

<script>


// ‚úÖ When user clicks enable sound button
document.getElementById('enable-sound').addEventListener('click', () => {
  audioAllowed = true;
  alert("üîî Sound enabled for notifications!");
  document.getElementById('enable-sound').style.display = 'none';
});

// ‚úÖ Live class checker
async function checkLiveClass() {
  try {
    const res = await fetch('/live_class');
    const data = await res.json();

    console.log("üîç Checking Live Status:", data);

    if (data.status === "LIVE") {
      showLiveNotification(data);  // FIXED HERE
    }
  } catch (err) {
    console.error("‚ùå Error fetching live class:", err);
  }
}


function showLiveNotification(data) {
  if (window.alreadyShown) return;
  window.alreadyShown = true;

  const box = document.createElement("div");
  box.id = "vy-live-popup";

  box.className = `
    fixed top-4 right-4 bg-green-600 text-white
    px-5 py-3 rounded-xl shadow-lg z-50
    transition-all duration-500
  `;

  box.style.animation = "slideIn 0.4s ease-out";

  box.innerHTML = `
    üé• <strong>${data.subject}</strong> class is <b>LIVE!</b><br>
    <a href="${data.meetLink}" target="_blank" class="underline text-yellow-300">Join Now</a>
  `;

  document.body.appendChild(box);

  setTimeout(() => box.remove(), 5000);
}



// üîÅ Check every 10 seconds
setInterval(checkLiveClass, 10000);
checkLiveClass();



</script>






<!-- üîπ AI Assistant JS -->
<script>
async function askAI() {
  const question = document.getElementById("ai-question").value.trim();
  const answerBox = document.getElementById("ai-answer");
  if (!question) return alert("Please type a question!");

  answerBox.innerText = "‚è≥ Thinking...";

  try {
    const res = await fetch("/ask_ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question })
    });
    const data = await res.json();
    if (data.answer) {
      answerBox.innerText = "üí° " + data.answer;
    } else {
      answerBox.innerText = "‚ùå Error: " + (data.error || "No response");
    }
  } catch (err) {
    answerBox.innerText = "‚ö†Ô∏è Network error, please retry.";
  }
}
</script>




<script>
  window.addEventListener("scroll", () => {
    const nav = document.getElementById("mainNav");
    if (window.scrollY > 10) {
      nav.classList.add("scrolled");
    } else {
      nav.classList.remove("scrolled");
    }
  });
</script>


<script>
  const menuBtn = document.getElementById("menuToggle");
  const mobileMenu = document.getElementById("mobileMenu");

  menuBtn.addEventListener("click", () => {
  mobileMenu.classList.toggle("hidden");
  });


async function submitBecomeTeacher(event) {
    event.preventDefault();

    const payload = {
        bio: document.getElementById('bt-bio').value,
        qualifications: document.getElementById('bt-qual').value,
        subjects: document.getElementById('bt-sub').value,
        experience_years: document.getElementById('bt-exp').value
    };

    console.log("üì§ Sending Teacher Data:", payload);

    const res = await fetch("/api/teacher/become", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
    });

    const data = await res.json();
    console.log("üì• Teacher Apply Response:", data);

    if (data.ok) {
        alert("üéâ You have successfully applied as a teacher!");
        navigateTo("dashboard");
    } else {
        alert("‚ùå Error: " + (data.error || "Unknown error"));
    }
}

async function checkTeacherStatus() {
  const res = await fetch("/api/teacher/me");
  const data = await res.json();

  if (!data.error) {
    document.getElementById("teacherDashboardBtn").classList.remove("hidden");
  }
}
checkTeacherStatus();




</script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  console.log("üåç Path detected:", window.location.pathname);

  const path = window.location.pathname;

  // üß† Direct Flask-rendered pages (optional future use)
  if (window.pageFromServer && window.pageFromServer !== "") {
    navigateTo(window.pageFromServer);
    return;
  }

  // 1Ô∏è‚É£ Handle SPA pages opened directly in new tab
 

  if (path === "/teachers") {
    navigateTo("teachers");
    return;
  }

  if (path === "/login") {
    navigateTo("login");
    return;
  }

  if (path === "/signup") {
    navigateTo("signup");
    return;
  }

  if (path === "/teacher-dashboard") {
    navigateTo("teacher-dashboard");
    return;
  }

  // 2Ô∏è‚É£ Default fallback ‚Üí HOME
  navigateTo("home");
});
</script>


<script>
  // This checks server session using an API endpoint
  fetch("/api/check-session")
    .then(res => res.json())
    .then(data => {
      if (data.logged_in === true) {
        state.isAuthenticated = true;
      }
    });
</script>

</body>
</html>
